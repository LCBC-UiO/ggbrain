<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting brain mesh atlases in plotly • ggseg</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plotting brain mesh atlases in plotly">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggseg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggseg.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/externalData.html">Adding external data to ggseg plotting</a>
    </li>
    <li>
      <a href="../articles/ggseg3d.html">Plotting brain mesh atlases in plotly</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/LCBC-UiO/ggseg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Plotting brain mesh atlases in plotly</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LCBC-UiO/ggseg/blob/master/vignettes/ggseg3d.Rmd"><code>vignettes/ggseg3d.Rmd</code></a></small>
      <div class="hidden name"><code>ggseg3d.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Some times, you want to plot the 3d-surfaces from freesurfer. Here, it is easier to use data from freesurfer (like annot and colorlut files) to create colours for the vectors. The data is somewhat more complex than the 2d ggplot polygon version <code>ggseg</code> <code><a href="../reference/ggseg3d.html">ggseg3d()</a></code> will create a plotly plot, which is interactive, and provides another type of flexibility to the user. A lot of credit goes to A.M.Winkler and his <a href="https://brainder.org/">Brainder</a> work, which supplied us with the first examples of going from <code>.srf</code> to <code>.ply</code> files, and whose scripts massively aided us in making this work.</p>
</div>
<div id="basic-use" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-use" class="anchor"></a>Basic use</h2>
<p>The function <code><a href="../reference/ggseg3d.html">ggseg3d()</a></code>, is based in the plotly, it is recommended to get a little familiarized with with <a href="https://plotly-book.cpsievert.me/">plotly</a>.</p>
<p>Out-of-the-box, ggseg() works without supplying any extra information. It will create a base plot of the aparc (dkt) brain segmentations. All <code>[...]_3d</code> atlases have a built in <code>colour</code> column for default colour plotting of the segments.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggseg)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>()</a></code></pre></div>
</div>
<div id="atlas-data" class="section level2">
<h2 class="hasAnchor">
<a href="#atlas-data" class="anchor"></a>Atlas data</h2>
<p>The data is stored in tibbles, and looks like so:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">dkt_3d</a></code></pre></div>
<p>To grab all the data for a surface and hemisphere, you should reduce the data to one line, and then <code><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dkt_3d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(surf <span class="op">==</span><span class="st"> "inflated"</span> <span class="op">&amp;</span><span class="st"> </span>hemi <span class="op">==</span><span class="st"> "right"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>()</a></code></pre></div>
</div>
<div id="external-data-supply" class="section level2">
<h2 class="hasAnchor">
<a href="#external-data-supply" class="anchor"></a>External data supply</h2>
<p>Particularly notice the <code>mesh</code> column, which is a list column of lists. In there is all the 6 vectors needed to create the mesh of the tri-surface plot. You’ll also need to notive the <code>label</code>, <code>annot</code> and <code>area</code> columns, which are likely the columns you will be matching on when proviging with your own data for colours. You need to be meticulous when fixing your data, be sure it matches. The function <em>should</em> give you a warning if it’s struggling to match something.</p>
<p>The column you want to use for colour, needs to be supplied to the <code>colour</code> option, and you’ll likely want to supply it to the <code>text</code> option, as this will add another line to the plotly hover information.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">someData =<span class="st"> </span>dkt_3d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(surf <span class="op">==</span><span class="st"> "inflated"</span> <span class="op">&amp;</span><span class="st"> </span>hemi <span class="op">==</span><span class="st"> "right"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(area) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">p =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,.<span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">100</span> ), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">           </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="dv">2</span>)) </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas =</span> dkt_3d, <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>)</a></code></pre></div>
</div>
<div id="colours" class="section level2">
<h2 class="hasAnchor">
<a href="#colours" class="anchor"></a>Colours</h2>
<!-- You can also change the palette. Choose from ALL the paletteer palettes, just use their name. -->
<!-- ```{r,fig.width=5} -->
<!--   ggseg3d(.data = someData, atlas = dkt_3d, colour = "p", text = "p", palette = "berlin") -->
<!--   ggseg3d(.data = someData, atlas = dkt_3d, colour = "p", text = "p", palette = "RdBu") -->
<!--   ggseg3d(.data = someData, atlas = dkt_3d, colour = "p", text = "p", palette = "GrandBudapest1") -->
<!-- ``` -->
<p>You can provide custom colour palettes either in hex or R-names</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas =</span> dkt_3d, </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">          <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>, </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">          <span class="dt">palette =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"forestgreen"</span>, <span class="st">"white"</span>, <span class="st">"firebrick"</span>))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas =</span> dkt_3d, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">          <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>, <span class="dt">palette =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#ff0000"</span>, <span class="st">"#00ff00"</span>, <span class="st">"#0000ff"</span>))</a></code></pre></div>
<p>If you want to alter the colour of <code>NA</code> regions, supply <code>na.colour</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas =</span> dkt_3d, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">          <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>, </a>
<a class="sourceLine" id="cb7-3" data-line-number="3">          <span class="dt">na.colour =</span> <span class="st">"black"</span>, <span class="dt">camera=</span><span class="st">"medial"</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas =</span> dkt_3d, </a>
<a class="sourceLine" id="cb7-5" data-line-number="5">          <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>, </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">          <span class="dt">na.colour =</span> <span class="st">"#ffff00"</span>, <span class="dt">camera=</span><span class="st">"medial"</span>)</a></code></pre></div>
<p>If you are plotting the sub-cortical structures, you might want to reduce the opacity of the <code>NA</code> structures, so that you can see the more medial structures. you may also want to add the <code>glassbrain</code> option, any value above 0 and up to 1 increases the opacity of a glass brain overlay.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">somData_aseg =<span class="st"> </span>aseg_3d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(label) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Ventricle|Putamen"</span>, label)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">p =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(.))) </a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> somData_aseg, <span class="dt">atlas =</span> aseg_3d, </a>
<a class="sourceLine" id="cb8-8" data-line-number="8">          <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">text =</span> <span class="st">"p"</span>, </a>
<a class="sourceLine" id="cb8-9" data-line-number="9">          <span class="dt">na.alpha=</span> <span class="fl">.5</span>, <span class="dt">glassbrain =</span> <span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb8-10" data-line-number="10">          <span class="dt">glassbrain_hemisphere =</span> <span class="st">"left"</span>)</a></code></pre></div>
</div>
<div id="camera" class="section level2">
<h2 class="hasAnchor">
<a href="#camera" class="anchor"></a>Camera</h2>
<p>You can rotate away all you like. if you want to start from the medial view, you can use the <code>camera</code> option</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">  <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">.data =</span> someData, <span class="dt">atlas=</span>dkt_3d, <span class="dt">colour =</span> <span class="st">"p"</span>, <span class="dt">camera =</span> <span class="st">"medial"</span>)</a></code></pre></div>
<p>There is also a surface of the white-matter</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"> <span class="kw"><a href="../reference/ggseg3d.html">ggseg3d</a></span>(<span class="dt">atlas=</span>dkt_3d, <span class="dt">surface=</span><span class="st">"white"</span>)</a></code></pre></div>
<p>There is much more you can do with the camera options, or by adding extra layout options to plotly. You may want to have a look at these resources if you want to do more complex adaptations to the plots:</p>
<p><a href="https://plot.ly/r/axes/#modifying-axes-for-3d-plots" class="uri">https://plot.ly/r/axes/#modifying-axes-for-3d-plots</a><br><a href="https://plot.ly/r/trisurf/" class="uri">https://plot.ly/r/trisurf/</a><br><a href="https://moderndata.plot.ly/trisurf-plots-in-r-using-plotly/" class="uri">https://moderndata.plot.ly/trisurf-plots-in-r-using-plotly/</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#basic-use">Basic use</a></li>
      <li><a href="#atlas-data">Atlas data</a></li>
      <li><a href="#external-data-supply">External data supply</a></li>
      <li><a href="#colours">Colours</a></li>
      <li><a href="#camera">Camera</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Athanasia Mo Mowinckel, Didac Vidal Pineiro.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
